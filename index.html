<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>電訪紀錄智慧產生器 (優化版)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', 'Noto Sans TC', sans-serif; background-color: #f8fafc; }
        .form-label { @apply block text-sm font-medium text-slate-700 mb-1.5; }
        .form-input, .form-select, .form-textarea { @apply w-full px-4 py-2.5 bg-white border border-slate-300 rounded-lg shadow-sm placeholder-slate-400 transition duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 hover:border-slate-400; }
        .form-textarea:read-only { background-color: #f8fafc; }
        .btn { @apply px-7 py-3 rounded-lg font-semibold text-white shadow-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-50 transition-all duration-300 ease-in-out transform hover:scale-[1.03]; }
        .btn-primary { @apply bg-blue-600 hover:bg-blue-700 focus:ring-blue-500; }
        .btn-secondary { @apply bg-slate-500 hover:bg-slate-600 focus:ring-slate-500 text-xs px-3 py-1; }
        .btn-success { @apply bg-emerald-500 hover:bg-emerald-600 focus:ring-emerald-500 text-xs px-3 py-1; }
        .btn-warning { @apply bg-amber-500 hover:bg-amber-600 focus:ring-amber-500 text-xs px-3 py-1; }
        .btn-outline { @apply bg-white text-slate-700 border border-slate-300 hover:bg-slate-50 focus:ring-blue-500; }
        .section-title { @apply text-xl font-bold text-slate-800 border-b-2 border-slate-200 pb-4 mb-6 tracking-wide; }
        .main-card { @apply bg-white rounded-3xl p-8 sm:p-10 relative transition-shadow duration-300 shadow-[0_8px_30px_rgb(0,0,0,0.05)]; }
        .hidden-section { display: none; }
        .validation-error { @apply text-red-500 text-xs mt-1; }
        #historyList li { @apply border-b border-slate-200 p-3 transition-colors hover:bg-slate-50; }
        #historyList li .summary { @apply text-slate-600 text-sm mt-1 truncate; }
        
        @media print {
            body * {
                visibility: hidden;
            }
            #print-area, #print-area * {
                visibility: visible;
            }
            #print-area {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .main-card {
                box-shadow: none;
                border: none;
            }
        }
    </style>
</head>
<body class="bg-slate-50">

    <div id="app-container" class="container mx-auto max-w-7xl p-4 sm:p-6 lg:p-8 grid grid-cols-1 xl:grid-cols-3 gap-8">
        <div class="main-card xl:col-span-2">
            <div class="text-center mb-12">
                <h1 class="text-4xl font-extrabold text-slate-900 tracking-tight">電訪紀錄智慧產生器 (優化版)</h1>
                <p class="text-slate-500 mt-3 max-w-2xl mx-auto">請透過下方「快速紀錄」選單描述案主狀況，系統將自動生成摘要並回填完整報告。</p>
            </div>

            <div id="quickInputForm" class="space-y-12">
                <section>
                    <h2 class="section-title">壹、基本資訊</h2>
                    <div class="bg-white p-6 rounded-xl border border-slate-200/80 grid grid-cols-1 md:grid-cols-1 gap-x-6 gap-y-6">
                        <div>
                            <label for="contactPhone" class="form-label font-semibold text-slate-800">聯繫電話</label>
                            <input type="tel" id="contactPhone" class="form-input mt-1" placeholder="例如：0912-345-678 或 02-1234-5678">
                            <p id="contactPhoneError" class="validation-error hidden-section">電話格式不正確</p>
                        </div>
                        
                        <div class="md:col-span-2">
                            <label class="form-label font-semibold text-slate-800">確認時間</label>
                            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mt-1">
                                <div class="p-3 bg-slate-50/70 rounded-lg border">
                                    <input type="date" id="confirmTime1" class="form-input">
                                    <input type="text" id="confirmTimeClock1" class="form-input mt-2" placeholder="時間 (例: 14:30)">
                                    <p id="confirmTimeClock1Error" class="validation-error hidden-section">時間格式應為 HH:MM</p>
                                </div>
                                <div class="p-3 bg-slate-50/70 rounded-lg border">
                                    <input type="date" id="confirmTime2" class="form-input">
                                    <input type="text" id="confirmTimeClock2" class="form-input mt-2" placeholder="時間 (例: 16:00)">
                                    <p id="confirmTimeClock2Error" class="validation-error hidden-section">時間格式應為 HH:MM</p>
                                </div>
                                <div class="p-3 bg-slate-50/70 rounded-lg border">
                                    <input type="date" id="confirmTime3" class="form-input">
                                    <input type="text" id="confirmTimeClock3" class="form-input mt-2" placeholder="時間 (例: 18:30)">
                                    <p id="confirmTimeClock3Error" class="validation-error hidden-section">時間格式應為 HH:MM</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <section>
                    <h2 class="section-title">貳、快速紀錄</h2>
                    <div class="bg-white p-6 rounded-xl border border-slate-200/80 grid grid-cols-1 lg:grid-cols-2 gap-6">
                        
                        <div class="flex items-center space-x-2 p-3 bg-slate-50 rounded-lg border border-slate-200">
                            <select id="livingCondition" class="form-select w-auto bg-slate-50 border-0 focus:ring-0">
                                <option value="案主與">案主與</option>
                                <option value="案主獨居">案主獨居</option>
                            </select>
                            <input type="text" id="livingWith" class="form-input" placeholder="例如:案配偶">
                            <span class="px-2 text-slate-600 whitespace-nowrap">同住</span>
                        </div>

                        <div>
                            <label class="form-label">生活自理狀況</label>
                             <select id="selfCareStatus" class="form-select">
                                <option value="生活自理無虞">生活自理無虞</option>
                                <option value="需他人協助">需他人協助</option>
                            </select>
                        </div>
                        
                        <div id="assistDetailContainer" class="hidden-section lg:col-span-2">
                            <label class="form-label">需協助項目</label>
                            <select id="assistDetailText" class="form-select">
                                <option value="備餐、安全照顧、家務">備餐、安全照顧、家務</option>
                                <option value="盥洗、更衣、備餐、安全照顧、家務">盥洗、更衣、備餐、安全照顧、家務</option>
                                <option value="盥洗、更衣、備餐、如廁、安全照顧、家務">盥洗、更衣、備餐、如廁、安全照顧、家務</option>
                                <option value="除用餐皆須協助">除用餐皆須協助</option>
                                <option value="皆需協助">皆需協助</option>
                                <option value="custom">其他(自行勾選)</option>
                            </select>
                            <div id="assistDetailCheckboxes" class="hidden-section mt-3 p-4 bg-slate-50 rounded-lg grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 text-sm">
                                <label class="flex items-center space-x-2"><input type="checkbox" value="盥洗" class="assist-checkbox rounded"><span>盥洗</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="更衣" class="assist-checkbox rounded"><span>更衣</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="用餐" class="assist-checkbox rounded"><span>用餐</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="備餐" class="assist-checkbox rounded"><span>備餐</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="如廁" class="assist-checkbox rounded"><span>如廁</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="移位" class="assist-checkbox rounded"><span>移位</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="室內移動" class="assist-checkbox rounded"><span>室內移動</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="室外移動" class="assist-checkbox rounded"><span>室外移動</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="安全照顧" class="assist-checkbox rounded"><span>安全照顧</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="家務" class="assist-checkbox rounded"><span>家務</span></label>
                            </div>
                        </div>

                        <div class="quick-input-group">
                             <label class="form-label">就業/就學狀況</label>
                             <select id="employmentSchoolStatus" class="form-select quick-input-group select">
                                <option value="無" selected>無</option>
                                <option value="就業中">就業中</option>
                                <option value="無業">無業</option>
                                <option value="就學中">就學中</option>
                            </select>
                        </div>

                        <div class="quick-input-group">
                             <label class="form-label">輔具使用</label>
                             <select id="aidsStatus" class="form-select quick-input-group select">
                                <option value="移行無須輔具">移行無須輔具</option>
                                <option value="移行須使用">移行須使用</option>
                            </select>
                        </div>

                        <div id="schoolDetailContainer" class="hidden-section">
                            <label class="form-label">就學詳情</label>
                            <select id="schoolDetailSelect" class="form-select">
                                <option value="幼兒園">幼兒園</option>
                                <option value="小學一般班">小學一般班</option>
                                <option value="小學特教資源班">小學特教資源班</option>
                                <option value="國中一般班">國中一般班</option>
                                <option value="國中特教資源班">國中特教資源班</option>
                                <option value="高中">高中</option>
                                <option value="大學">大學</option>
                                <option value="custom">其他(自行填寫)</option>
                            </select>
                            <input type="text" id="schoolDetailCustom" class="form-input hidden-section mt-2" placeholder="請輸入就學狀況">
                        </div>

                        <div id="aidsDetailContainer" class="hidden-section">
                            <label class="form-label">輔具詳情</label>
                            <select id="aidsDetailSelect" class="form-select">
                                <option value="拐杖">拐杖</option>
                                <option value="助行器">助行器</option>
                                <option value="輪椅">輪椅</option>
                                <option value="拐杖，外出須使用輪椅">拐杖，外出須使用輪椅</option>
                                <option value="custom">自行填寫</option>
                            </select>
                            <input type="text" id="aidsDetailCustom" class="form-input hidden-section mt-2" placeholder="請輸入輔具名稱">
                        </div>
                        
                         <div class="quick-input-group lg:col-span-2">
                             <label class="form-label">護理需求</label>
                             <select id="nursingStatus" class="form-select quick-input-group select">
                                <option value="無" selected>無</option>
                                <option value="有護理需求">有護理需求</option>
                            </select>
                            <div id="nursingDetailContainer" class="hidden-section mt-3 p-4 bg-slate-50 rounded-lg flex flex-wrap gap-x-6 gap-y-3 text-sm">
                                <label class="flex items-center space-x-2"><input type="checkbox" value="鼻胃管" class="nursing-checkbox rounded"><span>鼻胃管</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="氣切" class="nursing-checkbox rounded"><span>氣切</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="尿管" class="nursing-checkbox rounded"><span>尿管</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="褥瘡" class="nursing-checkbox rounded"><span>褥瘡</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="造廔口" class="nursing-checkbox rounded"><span>造廔口</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="洗腎" class="nursing-checkbox rounded"><span>洗腎</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" id="nursingOtherCheckbox" class="rounded"><span>其他</span></label>
                                <input type="text" id="nursingDetailCustom" class="form-input hidden-section w-auto flex-grow h-10 ml-2" placeholder="請輸入...">
                            </div>
                        </div>

                        <div class="quick-input-group lg:col-span-2">
                             <label class="form-label">長照使用</label>
                             <select id="ltcStatus" class="form-select quick-input-group select">
                                <option value="無" selected>無</option>
                                <option value="長照服務暫無需求">長照服務暫無需求</option>
                                <option value="已使用長照服務">已使用長照服務</option>
                            </select>
                            <div id="ltcDetailContainer" class="hidden-section mt-3 p-4 bg-slate-50 rounded-lg flex flex-wrap gap-x-6 gap-y-3 text-sm">
                                <label class="flex items-center space-x-2"><input type="checkbox" value="居家服務" class="ltc-checkbox rounded"><span>居家服務</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="專業服務" class="ltc-checkbox rounded"><span>專業服務</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="喘息服務" class="ltc-checkbox rounded"><span>喘息服務</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="營養餐飲服務" class="ltc-checkbox rounded"><span>營養餐飲服務</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="日間照顧服務" class="ltc-checkbox rounded"><span>日間照顧服務</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="交通接送" class="ltc-checkbox rounded"><span>交通接送</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="居家無障礙環境改善" class="ltc-checkbox rounded"><span>居家無障礙環境改善</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="家庭托顧" class="ltc-checkbox rounded"><span>家庭托顧</span></label>
                            </div>
                        </div>

                        <div class="lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="otherSupplementaryText" class="form-label">其他補充事項</label>
                                <textarea id="otherSupplementaryText" class="form-textarea" rows="2" placeholder="例如：OO為主照，生活自理無虞"></textarea>
                            </div>
                            <div class="flex items-center">
                                <label class="flex items-center space-x-2 text-sm cursor-pointer">
                                    <input type="checkbox" id="twoDisabledCheckbox" class="rounded">
                                    <span>家中有兩名以上身障者，經評估暫無風險</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="lg:col-span-2 bg-slate-50 p-4 rounded-lg border border-slate-200">
                            <label class="form-label font-semibold text-slate-800 mb-3">提供福利資訊</label>
                            <div id="welfareCheckboxContainer" class="space-y-4 text-sm">
                                <div><p class="font-medium text-slate-600 mb-2">一、</p><div class="flex flex-wrap gap-x-6 gap-y-2" data-group="1"><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="身障停車位識別證(已確認符合行動不便)"><span>身障停車位識別證</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="復康巴士"><span>復康巴士</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="必要陪伴者優惠措施"><span>必要陪伴者優惠措施</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="身障生活補助"><span>身障生活補助</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="身障房屋租金補貼"><span>身障房屋租金補貼</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="用電優惠"><span>用電優惠</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="就醫部分負擔減免"><span>就醫部分負擔減免</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="購屋貸款利息補貼"><span>購屋貸款利息補貼</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="購買或承租商店攤販低利貸款或租金補貼"><span>商店攤販貸款/租補</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="購買停車位貸款利息補貼"><span>購買停車位貸款利息補貼</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="承租停車位補助"><span>承租停車位補助</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="低收入戶、中低收入戶申請"><span>低收/中低收申請</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="發展遲緩兒童療育補助"><span>發展遲緩兒童療育補助</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="身障鑑定流程"><span>身障鑑定流程</span></label></div></div>
                                <div><p class="font-medium text-slate-600 mb-2">二、長照服務的</p><div class="flex flex-wrap gap-x-6 gap-y-2" data-group="2"><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="居家服務"><span>居家服務</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="專業服務(居家復能、營養、照護技巧、護理指導等)"><span>專業服務</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="喘息服務"><span>喘息服務</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="營養餐飲服務"><span>營養餐飲服務</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="日間照顧服務"><span>日間照顧服務</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="交通接送"><span>交通接送</span></label><label class="
