<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›»è¨ªç´€éŒ„æ™ºæ…§ç”¢ç”Ÿå™¨ (å„ªåŒ–ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', 'Noto Sans TC', sans-serif; background-color: #f8fafc; }
        .form-label { @apply block text-sm font-medium text-slate-700 mb-1.5; }
        .form-input, .form-select, .form-textarea { @apply w-full px-4 py-2.5 bg-white border border-slate-300 rounded-lg shadow-sm placeholder-slate-400 transition duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 hover:border-slate-400; }
        .form-textarea:read-only { background-color: #f8fafc; cursor: default; }
        .btn { @apply px-7 py-3 rounded-lg font-semibold text-white shadow-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-50 transition-all duration-300 ease-in-out transform hover:scale-[1.03]; }
        .btn-primary { @apply bg-blue-600 hover:bg-blue-700 focus:ring-blue-500; }
        .btn-secondary { @apply bg-slate-500 hover:bg-slate-600 focus:ring-slate-500 text-xs px-3 py-1; }
        .btn-success { @apply bg-emerald-500 hover:bg-emerald-600 focus:ring-emerald-500 text-xs px-3 py-1; }
        .btn-warning { @apply bg-amber-500 hover:bg-amber-600 focus:ring-amber-500 text-xs px-3 py-1; }
        .btn-outline { @apply bg-white text-slate-700 border border-slate-300 hover:bg-slate-50 focus:ring-blue-500; }
        .section-title { @apply text-xl font-bold text-slate-800 border-b-2 border-slate-200 pb-4 mb-6 tracking-wide; }
        .main-card { @apply bg-white rounded-3xl p-8 sm:p-10 relative transition-shadow duration-300 shadow-[0_8px_30px_rgb(0,0,0,0.05)]; }
        .hidden-section { display: none !important; }
        .validation-error { @apply text-red-500 text-xs mt-1; }
        input[type="checkbox"]:disabled + span { @apply text-slate-400; }
        #historyList li { @apply border-b border-slate-200 p-3 transition-colors hover:bg-slate-50; }
        #historyList li .summary { @apply text-slate-600 text-sm mt-1 truncate; }
        
        @media print {
            body * {
                visibility: hidden;
            }
            #print-area, #print-area * {
                visibility: visible;
            }
            #print-area {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                padding: 1rem;
            }
            .main-card {
                box-shadow: none;
                border: none;
            }
            .section-title {
                margin-top: 1.5rem;
            }
        }
    </style>
</head>
<body class="bg-slate-50">

    <div id="app-container" class="container mx-auto max-w-7xl p-4 sm:p-6 lg:p-8 grid grid-cols-1 xl:grid-cols-3 gap-8">
        <div class="main-card xl:col-span-2">
            <div class="text-center mb-12">
                <h1 class="text-4xl font-extrabold text-slate-900 tracking-tight">é›»è¨ªç´€éŒ„æ™ºæ…§ç”¢ç”Ÿå™¨ (å„ªåŒ–ç‰ˆ)</h1>
                <p class="text-slate-500 mt-3 max-w-2xl mx-auto">è«‹é€éä¸‹æ–¹ã€Œå¿«é€Ÿç´€éŒ„ã€é¸å–®æè¿°æ¡ˆä¸»ç‹€æ³ï¼Œç³»çµ±å°‡è‡ªå‹•ç”Ÿæˆæ‘˜è¦ä¸¦å›å¡«å®Œæ•´å ±å‘Šã€‚</p>
            </div>

            <form id="quickInputForm" class="space-y-12">
                <!-- åŸºæœ¬è³‡è¨Š -->
                <section>
                    <h2 class="section-title">å£¹ã€åŸºæœ¬è³‡è¨Š</h2>
                    <div class="bg-white p-6 rounded-xl border border-slate-200/80 grid grid-cols-1 md:grid-cols-1 gap-x-6 gap-y-6">
                        <div>
                            <label for="contactPhone" class="form-label font-semibold text-slate-800">è¯ç¹«é›»è©±</label>
                            <input type="tel" id="contactPhone" class="form-input mt-1" placeholder="ä¾‹å¦‚ï¼š0912-345-678 æˆ– 02-1234-5678">
                        </div>
                        
                        <div class="md:col-span-2">
                            <label class="form-label font-semibold text-slate-800">ç¢ºèªæ™‚é–“</label>
                            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mt-1">
                                <div class="p-3 bg-slate-50/70 rounded-lg border">
                                    <input type="date" id="confirmTime1" class="form-input">
                                    <input type="text" id="confirmTimeClock1" class="form-input mt-2" placeholder="æ™‚é–“ (ä¾‹: 14:30)">
                                </div>
                                <div class="p-3 bg-slate-50/70 rounded-lg border">
                                    <input type="date" id="confirmTime2" class="form-input">
                                    <input type="text" id="confirmTimeClock2" class="form-input mt-2" placeholder="æ™‚é–“ (ä¾‹: 16:00)">
                                </div>
                                <div class="p-3 bg-slate-50/70 rounded-lg border">
                                    <input type="date" id="confirmTime3" class="form-input">
                                    <input type="text" id="confirmTimeClock3" class="form-input mt-2" placeholder="æ™‚é–“ (ä¾‹: 18:30)">
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- å¿«é€Ÿç´€éŒ„å€ -->
                <section>
                    <h2 class="section-title">è²³ã€å¿«é€Ÿç´€éŒ„</h2>
                    <div class="bg-white p-6 rounded-xl border border-slate-200/80 grid grid-cols-1 lg:grid-cols-2 gap-6">
                        
                        <div class="flex items-center space-x-2 p-3 bg-slate-50 rounded-lg border border-slate-200">
                            <select id="livingCondition" class="form-select w-auto bg-slate-50 border-0 focus:ring-0">
                                <option value="æ¡ˆä¸»èˆ‡">æ¡ˆä¸»èˆ‡</option>
                                <option value="æ¡ˆä¸»ç¨å±…">æ¡ˆä¸»ç¨å±…</option>
                            </select>
                            <input type="text" id="livingWith" class="form-input" placeholder="ä¾‹å¦‚:æ¡ˆé…å¶">
                            <span class="px-2 text-slate-600 whitespace-nowrap">åŒä½</span>
                        </div>

                        <div>
                            <label class="form-label">ç”Ÿæ´»è‡ªç†ç‹€æ³</label>
                             <select id="selfCareStatus" class="form-select">
                                <option value="ç”Ÿæ´»è‡ªç†ç„¡è™">ç”Ÿæ´»è‡ªç†ç„¡è™</option>
                                <option value="éœ€ä»–äººå”åŠ©">éœ€ä»–äººå”åŠ©</option>
                            </select>
                        </div>
                        
                        <div id="assistDetailContainer" class="hidden-section lg:col-span-2">
                            <label class="form-label">éœ€å”åŠ©é …ç›®</label>
                            <div id="assistDetailCheckboxes" class="mt-2 p-4 bg-slate-50 rounded-lg grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 text-sm">
                                <label class="flex items-center space-x-2 font-bold text-blue-600"><input type="checkbox" id="assistAllCheckbox" class="rounded"><span>å…¨éƒ¨</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="ç›¥æ´—" class="assist-checkbox rounded"><span>ç›¥æ´—</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="æ›´è¡£" class="assist-checkbox rounded"><span>æ›´è¡£</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="ç”¨é¤" class="assist-checkbox rounded"><span>ç”¨é¤</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="å‚™é¤" class="assist-checkbox rounded"><span>å‚™é¤</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="å¦‚å»" class="assist-checkbox rounded"><span>å¦‚å»</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="ç§»ä½" class="assist-checkbox rounded"><span>ç§»ä½</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="å®¤å…§ç§»å‹•" class="assist-checkbox rounded"><span>å®¤å…§ç§»å‹•</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="å®¤å¤–ç§»å‹•" class="assist-checkbox rounded"><span>å®¤å¤–ç§»å‹•</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="å®‰å…¨ç…§é¡§" class="assist-checkbox rounded"><span>å®‰å…¨ç…§é¡§</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="å®¶å‹™" class="assist-checkbox rounded"><span>å®¶å‹™</span></label>
                            </div>
                        </div>

                        <div>
                             <label class="form-label">å°±æ¥­/å°±å­¸ç‹€æ³</label>
                             <select id="employmentSchoolStatus" class="form-select">
                                <option value="ç„¡" selected>ç„¡</option>
                                <option value="å°±æ¥­ä¸­">å°±æ¥­ä¸­</option>
                                <option value="ç„¡æ¥­">ç„¡æ¥­</option>
                                <option value="å°±å­¸ä¸­">å°±å­¸ä¸­</option>
                            </select>
                        </div>

                        <div>
                             <label class="form-label">è¼”å…·ä½¿ç”¨</label>
                             <select id="aidsStatus" class="form-select">
                                <option value="ç§»è¡Œç„¡é ˆè¼”å…·">ç§»è¡Œç„¡é ˆè¼”å…·</option>
                                <option value="ç§»è¡Œé ˆä½¿ç”¨">ç§»è¡Œé ˆä½¿ç”¨</option>
                            </select>
                        </div>

                        <div id="schoolDetailContainer" class="hidden-section">
                            <label class="form-label">å°±å­¸è©³æƒ…</label>
                            <select id="schoolDetailSelect" class="form-select">
                                <option value="å¹¼å…’åœ’">å¹¼å…’åœ’</option>
                                <option value="å°å­¸ä¸€èˆ¬ç­">å°å­¸ä¸€èˆ¬ç­</option>
                                <option value="å°å­¸ç‰¹æ•™è³‡æºç­">å°å­¸ç‰¹æ•™è³‡æºç­</option>
                                <option value="åœ‹ä¸­ä¸€èˆ¬ç­">åœ‹ä¸­ä¸€èˆ¬ç­</option>
                                <option value="åœ‹ä¸­ç‰¹æ•™è³‡æºç­">åœ‹ä¸­ç‰¹æ•™è³‡æºç­</option>
                                <option value="é«˜ä¸­">é«˜ä¸­</option>
                                <option value="å¤§å­¸">å¤§å­¸</option>
                                <option value="custom">å…¶ä»–(è‡ªè¡Œå¡«å¯«)</option>
                            </select>
                            <input type="text" id="schoolDetailCustom" class="form-input hidden-section mt-2" placeholder="è«‹è¼¸å…¥å°±å­¸ç‹€æ³">
                        </div>

                        <div id="aidsDetailContainer" class="hidden-section">
                            <label class="form-label">è¼”å…·è©³æƒ…</label>
                            <select id="aidsDetailSelect" class="form-select">
                                <option value="æ‹æ–">æ‹æ–</option>
                                <option value="åŠ©è¡Œå™¨">åŠ©è¡Œå™¨</option>
                                <option value="è¼ªæ¤…">è¼ªæ¤…</option>
                                <option value="custom">è‡ªè¡Œå¡«å¯«</option>
                            </select>
                            <input type="text" id="aidsDetailCustom" class="form-input hidden-section mt-2" placeholder="è«‹è¼¸å…¥è¼”å…·åç¨±">
                        </div>
                        
                         <div class="lg:col-span-2">
                             <label class="form-label">è­·ç†éœ€æ±‚</label>
                             <select id="nursingStatus" class="form-select">
                                <option value="ç„¡" selected>ç„¡</option>
                                <option value="æœ‰è­·ç†éœ€æ±‚">æœ‰è­·ç†éœ€æ±‚</option>
                            </select>
                            <div id="nursingDetailContainer" class="hidden-section mt-3 p-4 bg-slate-50 rounded-lg flex flex-wrap gap-x-6 gap-y-3 text-sm">
                                <label class="flex items-center space-x-2"><input type="checkbox" value="é¼»èƒƒç®¡" class="nursing-checkbox rounded"><span>é¼»èƒƒç®¡</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="æ°£åˆ‡" class="nursing-checkbox rounded"><span>æ°£åˆ‡</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="å°¿ç®¡" class="nursing-checkbox rounded"><span>å°¿ç®¡</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="è¤¥ç˜¡" class="nursing-checkbox rounded"><span>è¤¥ç˜¡</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="é€ å»”å£" class="nursing-checkbox rounded"><span>é€ å»”å£</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="æ´—è…" class="nursing-checkbox rounded"><span>æ´—è…</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" id="nursingOtherCheckbox" class="rounded"><span>å…¶ä»–</span></label>
                                <input type="text" id="nursingDetailCustom" class="form-input hidden-section w-auto flex-grow h-10 ml-2" placeholder="è«‹è¼¸å…¥...">
                            </div>
                        </div>

                        <div class="lg:col-span-2">
                            <div class="flex items-center mb-1.5">
                                <label for="ltcStatus" class="form-label mb-0 mr-4">é•·ç…§ä½¿ç”¨</label>
                                <label class="flex items-center space-x-2 text-xs text-slate-600 cursor-pointer">
                                    <input type="checkbox" id="ltcIncludeInSummary" class="rounded" checked>
                                    <span>ç´å…¥æ‘˜è¦</span>
                                </label>
                            </div>
                             <select id="ltcStatus" class="form-select">
                                <option value="ç„¡" selected>ç„¡</option>
                                <option value="é•·ç…§æœå‹™æš«ç„¡éœ€æ±‚">é•·ç…§æœå‹™æš«ç„¡éœ€æ±‚</option>
                                <option value="å·²ä½¿ç”¨é•·ç…§æœå‹™">å·²ä½¿ç”¨é•·ç…§æœå‹™</option>
                            </select>
                            <div id="ltcDetailContainer" class="hidden-section mt-3 p-4 bg-slate-50 rounded-lg flex flex-wrap gap-x-6 gap-y-3 text-sm">
                                <label class="flex items-center space-x-2"><input type="checkbox" value="å±…å®¶æœå‹™" class="ltc-checkbox rounded"><span>å±…å®¶æœå‹™</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="å°ˆæ¥­æœå‹™" class="ltc-checkbox rounded"><span>å°ˆæ¥­æœå‹™</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="å–˜æ¯æœå‹™" class="ltc-checkbox rounded"><span>å–˜æ¯æœå‹™</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="ç‡Ÿé¤Šé¤é£²æœå‹™" class="ltc-checkbox rounded"><span>ç‡Ÿé¤Šé¤é£²æœå‹™</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="æ—¥é–“ç…§é¡§æœå‹™" class="ltc-checkbox rounded"><span>æ—¥é–“ç…§é¡§æœå‹™</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="äº¤é€šæ¥é€" class="ltc-checkbox rounded"><span>äº¤é€šæ¥é€</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="å±…å®¶ç„¡éšœç¤™ç’°å¢ƒæ”¹å–„" class="ltc-checkbox rounded"><span>å±…å®¶ç„¡éšœç¤™ç’°å¢ƒæ”¹å–„</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="å®¶åº­æ‰˜é¡§" class="ltc-checkbox rounded"><span>å®¶åº­æ‰˜é¡§</span></label>
                            </div>
                        </div>

                        <div class="lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="otherSupplementaryText" class="form-label">å…¶ä»–è£œå……äº‹é …</label>
                                <textarea id="otherSupplementaryText" class="form-textarea" rows="2" placeholder="ä¾‹å¦‚ï¼šOOç‚ºä¸»ç…§ï¼Œç”Ÿæ´»è‡ªç†ç„¡è™"></textarea>
                            </div>
                            <div class="flex items-center">
                                <label class="flex items-center space-x-2 text-sm cursor-pointer">
                                    <input type="checkbox" id="twoDisabledCheckbox" class="rounded">
                                    <span>å®¶ä¸­æœ‰å…©åä»¥ä¸Šèº«éšœè€…ï¼Œç¶“è©•ä¼°æš«ç„¡é¢¨éšª</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="lg:col-span-2 bg-slate-50 p-4 rounded-lg border border-slate-200">
                            <label class="form-label font-semibold text-slate-800 mb-3">æä¾›ç¦åˆ©è³‡è¨Š</label>
                            <div id="welfareCheckboxContainer" class="space-y-4 text-sm">
                                <div><p class="font-medium text-slate-600 mb-2">ä¸€ã€</p><div class="flex flex-wrap gap-x-6 gap-y-2" data-group="1"><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="èº«éšœåœè»Šä½è­˜åˆ¥è­‰(å·²ç¢ºèªç¬¦åˆè¡Œå‹•ä¸ä¾¿)"><span>èº«éšœåœè»Šä½è­˜åˆ¥è­‰</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="å¾©åº·å·´å£«"><span>å¾©åº·å·´å£«</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="å¿…è¦é™ªä¼´è€…å„ªæƒ æªæ–½"><span>å¿…è¦é™ªä¼´è€…å„ªæƒ æªæ–½</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="èº«éšœç”Ÿæ´»è£œåŠ©"><span>èº«éšœç”Ÿæ´»è£œåŠ©</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="èº«éšœæˆ¿å±‹ç§Ÿé‡‘è£œè²¼"><span>èº«éšœæˆ¿å±‹ç§Ÿé‡‘è£œè²¼</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="ç”¨é›»å„ªæƒ "><span>ç”¨é›»å„ªæƒ </span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="å°±é†«éƒ¨åˆ†è² æ“”æ¸›å…"><span>å°±é†«éƒ¨åˆ†è² æ“”æ¸›å…</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="è³¼å±‹è²¸æ¬¾åˆ©æ¯è£œè²¼"><span>è³¼å±‹è²¸æ¬¾åˆ©æ¯è£œè²¼</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="è³¼è²·æˆ–æ‰¿ç§Ÿå•†åº—æ”¤è²©ä½åˆ©è²¸æ¬¾æˆ–ç§Ÿé‡‘è£œè²¼"><span>å•†åº—æ”¤è²©è²¸æ¬¾/ç§Ÿè£œ</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="è³¼è²·åœè»Šä½è²¸æ¬¾åˆ©æ¯è£œè²¼"><span>è³¼è²·åœè»Šä½è²¸æ¬¾åˆ©æ¯è£œè²¼</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="æ‰¿ç§Ÿåœè»Šä½è£œåŠ©"><span>æ‰¿ç§Ÿåœè»Šä½è£œåŠ©</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="ä½æ”¶å…¥æˆ¶ã€ä¸­ä½æ”¶å…¥æˆ¶ç”³è«‹"><span>ä½æ”¶/ä¸­ä½æ”¶ç”³è«‹</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="ç™¼å±•é²ç·©å…’ç«¥ç™‚è‚²è£œåŠ©"><span>ç™¼å±•é²ç·©å…’ç«¥ç™‚è‚²è£œåŠ©</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="èº«éšœé‘‘å®šæµç¨‹"><span>èº«éšœé‘‘å®šæµç¨‹</span></label></div></div>
                                <div><p class="font-medium text-slate-600 mb-2">äºŒã€é•·ç…§æœå‹™çš„</p><div class="flex flex-wrap gap-x-6 gap-y-2" data-group="2"><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="å±…å®¶æœå‹™"><span>å±…å®¶æœå‹™</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="å°ˆæ¥­æœå‹™(å±…å®¶å¾©èƒ½ã€ç‡Ÿé¤Šã€ç…§è­·æŠ€å·§ã€è­·ç†æŒ‡å°ç­‰)"><span>å°ˆæ¥­æœå‹™</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="å–˜æ¯æœå‹™"><span>å–˜æ¯æœå‹™</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="ç‡Ÿé¤Šé¤é£²æœå‹™"><span>ç‡Ÿé¤Šé¤é£²æœå‹™</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="æ—¥é–“ç…§é¡§æœå‹™"><span>æ—¥é–“ç…§é¡§æœå‹™</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="äº¤é€šæ¥é€"><span>äº¤é€šæ¥é€</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="å±…å®¶ç„¡éšœç¤™ç’°å¢ƒæ”¹å–„"><span>å±…å®¶ç„¡éšœç¤™ç’°å¢ƒæ”¹å–„</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="å®¶åº­æ‰˜é¡§"><span>å®¶åº­æ‰˜é¡§</span></label></div></div>
                                <div><p class="font-medium text-slate-600 mb-2">ä¸‰ã€</p><div class="flex flex-wrap gap-x-6 gap-y-2" data-group="3"><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="å°±æ¥­æœå‹™"><span>å°±æ¥­æœå‹™</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="è¼”å…·æœå‹™åŠè£œåŠ©æµç¨‹"><span>è¼”å…·æœå‹™åŠè£œåŠ©æµç¨‹</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="å©šå§»è¼”å°"><span>å©šå§»è¼”å°</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="ç”Ÿè‚²è¼”å°"><span>ç”Ÿè‚²è¼”å°</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="å¿ƒç†é‡å»º"><span>å¿ƒç†é‡å»º</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="è¡Œç‚ºè¼”å°"><span>è¡Œç‚ºè¼”å°</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="èª²å¾Œç…§é¡§"><span>èª²å¾Œç…§é¡§</span></label></div></div>
                                <div><p class="font-medium text-slate-600 mb-2">å››ã€</p><div class="flex flex-wrap gap-x-6 gap-y-2" data-group="4"><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="ç”Ÿæ´»é‡å»ºæœå‹™"><span>ç”Ÿæ´»é‡å»ºæœå‹™</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="è‡ªç«‹ç”Ÿæ´»æ”¯æŒæœå‹™"><span>è‡ªç«‹ç”Ÿæ´»æ”¯æŒæœå‹™</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="ç¤¾å€å¼æ—¥é–“ç…§é¡§æœå‹™"><span>ç¤¾å€å¼æ—¥é–“ç…§é¡§æœå‹™</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="ç¤¾å€å±…ä½"><span>ç¤¾å€å±…ä½</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="ç¤¾å€æ—¥é–“ä½œæ¥­è¨­æ–½æœå‹™"><span>ç¤¾å€æ—¥é–“ä½œæ¥­è¨­æ–½</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="è‡¨æ™‚åŠçŸ­æœŸç…§é¡§æœå‹™"><span>è‡¨æ™‚åŠçŸ­æœŸç…§é¡§æœå‹™</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="å®¶åº­æ‰˜é¡§æœå‹™"><span>å®¶åº­æ‰˜é¡§æœå‹™</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="æ©Ÿæ§‹å¼æ—¥é–“ç…§é¡§æœå‹™ã€â–¡æœ‰æä¾›åå†Šã€‘"><span>æ©Ÿæ§‹å¼æ—¥é–“ç…§é¡§æœå‹™</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="ä½å®¿å¼ç…§é¡§æœå‹™ã€â–¡æœ‰æä¾›åå†Šã€‘"><span>ä½å®¿å¼ç…§é¡§æœå‹™</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="æ—¥é–“åŠä½å®¿å¼ç…§é¡§è²»ç”¨è£œåŠ©"><span>ç…§é¡§è²»ç”¨è£œåŠ©</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="ä½å®¿å¼æœå‹™æ©Ÿæ§‹ä½¿ç”¨è€…è£œåŠ©æ–¹æ¡ˆ"><span>æ©Ÿæ§‹ä½¿ç”¨è€…è£œåŠ©</span></label></div></div>
                                <div><p class="font-medium text-slate-600 mb-2">äº”ã€</p><div class="flex flex-wrap gap-x-6 gap-y-2 items-center" data-group="5"><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="èº«éšœç¤¾å€é•·ç…§æ©Ÿæ§‹"><span>èº«éšœç¤¾å€é•·ç…§æ©Ÿæ§‹</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="ç²¾ç¥éšœç¤™è€…æœƒæ‰€"><span>ç²¾ç¥éšœç¤™è€…æœƒæ‰€</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="å¤–ç±çœ‹è­·ç”³è«‹æµç¨‹åŠæ–¹å¼"><span>å¤–ç±çœ‹è­·ç”³è«‹</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="é˜²èµ°å¤±æ‰‹éŠ"><span>é˜²èµ°å¤±æ‰‹éŠ</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="ç·Šæ€¥æ•‘æ´ç³»çµ±"><span>ç·Šæ€¥æ•‘æ´ç³»çµ±</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="ç¨è€æœå‹™"><span>ç¨è€æœå‹™</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="æŒ‡ç´‹æºå°"><span>æŒ‡ç´‹æºå°</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="welfare-checkbox rounded" value="èº«æœä¸­å¿ƒ"><span>èº«æœä¸­å¿ƒ</span></label><label class="flex items-center space-x-2"><input type="checkbox" id="welfareOtherCheckbox"><span>å…¶ä»–</span></label><input type="text" id="welfareOtherText" class="form-input hidden-section w-auto flex-grow h-10" placeholder="è«‹è¼¸å…¥..."></div></div>
                            </div>
                        </div>
                    </div>
                </section>
            </form>

            <div class="mt-16 flex flex-col sm:flex-row justify-center items-center gap-4">
                <button id="clearBtn" type="button" class="btn btn-outline w-full sm:w-auto">æ¸…é™¤é‡å¡«</button>
                <button id="generateBtn" type="button" class="btn btn-primary w-full sm:w-auto">ç”¢ç”Ÿå ±å‘Š</button>
            </div>

            <!-- è¼¸å‡ºå€ -->
            <div id="outputSection" class="mt-16 hidden-section">
                <div class="flex justify-end mb-4">
                    <button id="printBtn" class="btn bg-gray-600 hover:bg-gray-700 focus:ring-gray-500 px-4 py-2 text-sm">ğŸ–¨ï¸ åˆ—å°å ±å‘Š</button>
                </div>
                <div id="print-area">
                    <!-- è¯ç¹«æ‘˜è¦è¼¸å‡º -->
                    <div class="mb-12">
                        <h2 class="section-title">æ‹¾å£¹ã€è¯ç¹«æ‘˜è¦</h2>
                        <div class="mt-4 relative">
                            <textarea id="summaryOutput" readonly class="form-textarea w-full bg-slate-50 p-6 rounded-lg border border-slate-200 min-h-[100px] text-slate-800 leading-relaxed tracking-wide"></textarea>
                            <button class="copyBtn btn bg-slate-600 hover:bg-slate-700 absolute top-4 right-4 px-4 py-1.5 text-sm" data-target="summaryOutput">è¤‡è£½</button>
                        </div>
                    </div>
                    <!-- å‹¾é¸å ±å‘Šè¼¸å‡º -->
                    <div>
                        <h2 class="section-title">æ¨™æº–æ ¼å¼å ±å‘Š (è‡ªå‹•åˆ¤è®€ç”Ÿæˆ)</h2>
                        <div class="mt-4 relative">
                            <textarea id="checkboxReportOutput" readonly class="form-textarea w-full bg-slate-50 p-6 rounded-lg border border-slate-200 min-h-[200px] text-slate-800 leading-relaxed tracking-wide whitespace-pre-wrap font-sans"></textarea>
                            <button class="copyBtn btn bg-slate-600 hover:bg-slate-700 absolute top-4 right-4 px-4 py-1.5 text-sm" data-target="checkboxReportOutput">è¤‡è£½</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- History Section -->
        <div class="main-card xl:col-span-1">
             <div class="flex justify-between items-center mb-6 border-b-2 border-slate-200 pb-4">
                <h2 class="text-xl font-bold text-slate-800">æ­·å²ç´€éŒ„</h2>
                <button id="clearHistoryBtn" class="btn-secondary rounded-md px-3 py-1 text-xs">æ¸…é™¤å…¨éƒ¨</button>
            </div>
            <div class="flex space-x-2 mb-4">
                <button id="exportHistoryBtn" class="btn-success flex-1">åŒ¯å‡ºç´€éŒ„</button>
                <button id="importHistoryBtn" class="btn-warning flex-1" onclick="document.getElementById('fileInput').click();">åŒ¯å…¥ç´€éŒ„</button>
                <input type="file" id="fileInput" class="hidden" accept=".json">
            </div>
            <ul id="historyList" class="space-y-2 max-h-[1200px] overflow-y-auto">
                <!-- History items will be injected here -->
            </ul>
        </div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const getEl = (id) => document.getElementById(id);
        const historyKey = 'reportGeneratorHistory';
        
        const getVal = (id) => {
            const el = getEl(id);
            return el ? el.value.trim() : '';
        };

        // --- è¨­å®šé è¨­æ—¥æœŸç‚ºä»Šå¤© ---
        const today = new Date();
        const timezoneOffset = today.getTimezoneOffset() * 60000;
        const localISOTime = (new Date(today - timezoneOffset)).toISOString().split('T')[0];
        getEl('confirmTime1').value = localISOTime;

        // --- å‹•æ…‹é¡¯ç¤ºè¼¸å…¥æ¡† ---
        const setupConditionalVisibility = (controllerId, targetId, showCondition) => {
            const controller = getEl(controllerId);
            const target = getEl(targetId);
            if (!controller || !target) return;
            
            const toggle = () => {
                let shouldShow = false;
                if (controller.type === 'checkbox') {
                    shouldShow = controller.checked;
                } else { // select
                    const showValues = Array.isArray(showCondition) ? showCondition : [showCondition];
                    shouldShow = showValues.includes(controller.value);
                }
                
                target.classList.toggle('hidden-section', !shouldShow);
            };

            controller.addEventListener('change', toggle);
            toggle(); // Initial check
        };
        
        const spanId = getEl('livingWith').nextElementSibling.id || (getEl('livingWith').nextElementSibling.id = `span-${Date.now()}`);
        setupConditionalVisibility('livingCondition', 'livingWith', 'æ¡ˆä¸»èˆ‡');
        setupConditionalVisibility('livingCondition', spanId, 'æ¡ˆä¸»èˆ‡');
        setupConditionalVisibility('selfCareStatus', 'assistDetailContainer', 'éœ€ä»–äººå”åŠ©');
        setupConditionalVisibility('employmentSchoolStatus', 'schoolDetailContainer', 'å°±å­¸ä¸­');
        setupConditionalVisibility('schoolDetailSelect', 'schoolDetailCustom', 'custom');
        setupConditionalVisibility('aidsStatus', 'aidsDetailContainer', 'ç§»è¡Œé ˆä½¿ç”¨');
        setupConditionalVisibility('aidsDetailSelect', 'aidsDetailCustom', 'custom');
        setupConditionalVisibility('nursingStatus', 'nursingDetailContainer', 'æœ‰è­·ç†éœ€æ±‚');
        setupConditionalVisibility('nursingOtherCheckbox', 'nursingDetailCustom', true);
        setupConditionalVisibility('ltcStatus', 'ltcDetailContainer', 'å·²ä½¿ç”¨é•·ç…§æœå‹™');
        setupConditionalVisibility('welfareOtherCheckbox', 'welfareOtherText', true);

        // --- Assist Checkbox Logic ---
        const assistAllCheckbox = getEl('assistAllCheckbox');
        const assistCheckboxes = document.querySelectorAll('.assist-checkbox');

        assistAllCheckbox.addEventListener('change', () => {
            const isChecked = assistAllCheckbox.checked;
            assistCheckboxes.forEach(cb => {
                if (isChecked) {
                    cb.checked = false;
                }
                cb.disabled = isChecked;
            });
        });

        assistCheckboxes.forEach(cb => {
            cb.addEventListener('change', () => {
                if (cb.checked) {
                    assistAllCheckbox.checked = false;
                    assistCheckboxes.forEach(innerCb => innerCb.disabled = false);
                }
            });
        });


        // --- ä¸»è¦æŒ‰éˆ•äº‹ä»¶ ---
        getEl('generateBtn').addEventListener('click', () => {
            const summaryText = generateSummary();
            if (summaryText.length <= 1) { 
                alert('è«‹è‡³å°‘å¡«å¯«ä¸€é …ä¸»è¦è³‡è¨Šä»¥ç”¢ç”Ÿå ±å‘Šã€‚');
                return;
            }

            getEl('summaryOutput').value = summaryText;
            const checkboxReportText = parseSummaryAndGenerateReport(summaryText);
            getEl('checkboxReportOutput').value = checkboxReportText;
            
            const outputSection = getEl('outputSection');
            outputSection.classList.remove('hidden-section');
            outputSection.scrollIntoView({ behavior: 'smooth' });

            saveToHistory(summaryText);
        });

        getEl('clearBtn').addEventListener('click', () => {
            if (confirm('æ‚¨ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰å·²å¡«å¯«çš„æ¬„ä½å—ï¼Ÿ')) {
                clearForm();
            }
        });

        function clearForm() {
            getEl('quickInputForm').reset();
            assistCheckboxes.forEach(cb => cb.disabled = false);
            getEl('ltcIncludeInSummary').checked = true; // Restore default checked state
            getEl('quickInputForm').querySelectorAll('select, input[type="checkbox"]').forEach(el => el.dispatchEvent(new Event('change')));
            getEl('confirmTime1').value = localISOTime;
            getEl('outputSection').classList.add('hidden-section');
        }

        // --- ç”¢ç”Ÿè¯ç¹«æ‘˜è¦ ---
        function generateSummary() {
            let parts = [];
            
            let livingText = getVal('livingCondition');
            parts.push(livingText === 'æ¡ˆä¸»èˆ‡' ? `æ¡ˆä¸»èˆ‡${getVal('livingWith') || 'å®¶äºº'}åŒä½` : 'æ¡ˆä¸»ç¨å±…');
            
            if (getVal('selfCareStatus') === 'ç”Ÿæ´»è‡ªç†ç„¡è™') {
                parts.push('ç”Ÿæ´»è‡ªç†ç„¡è™');
            }

            const employmentSchool = getVal('employmentSchoolStatus');
            if (employmentSchool !== 'ç„¡') {
                 if (employmentSchool === 'å°±å­¸ä¸­') {
                    let schoolDetails = getVal('schoolDetailSelect');
                    if (schoolDetails === 'custom') schoolDetails = getVal('schoolDetailCustom');
                    parts.push(schoolDetails ? `ç›®å‰å°±å­¸ä¸­(${schoolDetails})` : 'ç›®å‰å°±å­¸ä¸­');
                } else {
                    parts.push(`ç›®å‰${employmentSchool}`);
                }
            }
            
            let aidsStatus = getVal('aidsStatus');
            if (aidsStatus === 'ç§»è¡Œé ˆä½¿ç”¨') {
                let aidsDetails = getVal('aidsDetailSelect');
                if (aidsDetails === 'custom') aidsDetails = getVal('aidsDetailCustom');
                parts.push(aidsDetails ? `ç§»è¡Œé ˆä½¿ç”¨${aidsDetails}` : 'ç§»è¡Œé ˆä½¿ç”¨è¼”å…·');
            } else {
                parts.push('ç§»è¡Œç„¡é ˆè¼”å…·');
            }
            
            if (getVal('nursingStatus') === 'æœ‰è­·ç†éœ€æ±‚') {
                const checkedNeeds = Array.from(document.querySelectorAll('.nursing-checkbox:checked')).map(cb => cb.value);
                if (getEl('nursingOtherCheckbox').checked) {
                    const customNeed = getVal('nursingDetailCustom');
                    if (customNeed) checkedNeeds.push(customNeed);
                }
                if (checkedNeeds.length > 0) parts.push(`æœ‰ ${checkedNeeds.join('ã€')} ç­‰è­·ç†éœ€æ±‚`);
            }
            
            if (getEl('ltcIncludeInSummary').checked) {
                const ltcStatus = getVal('ltcStatus');
                if (ltcStatus === 'å·²ä½¿ç”¨é•·ç…§æœå‹™') {
                    const checkedServices = Array.from(document.querySelectorAll('.ltc-checkbox:checked')).map(cb => cb.value.replace('æœå‹™',''));
                    if (checkedServices.length > 0) {
                         parts.push(`å·²ä½¿ç”¨é•·ç…§${checkedServices.join('ã€')}ç­‰æœå‹™é …ç›®`);
                    } else {
                        parts.push('å·²ä½¿ç”¨é•·ç…§æœå‹™');
                    }
                } else if (ltcStatus === 'ç„¡') {
                    parts.push('ç„¡ä½¿ç”¨é•·ç…§æœå‹™');
                } else { 
                    parts.push(ltcStatus);
                }
            }
            
            if(getEl('twoDisabledCheckbox').checked) parts.push('å®¶ä¸­æœ‰å…©åä»¥ä¸Šèº«éšœè€…ï¼Œç¶“è©•ä¼°æš«ç„¡é¢¨éšª');
            if (getVal('otherSupplementaryText')) parts.push(getVal('otherSupplementaryText'));

            return parts.filter(Boolean).join('ï¼Œ') + 'ã€‚';
        }

        // --- æ ¸å¿ƒï¼šè§£ææ‘˜è¦ä¸¦ç”¢ç”Ÿå ±å‘Š ---
        function parseSummaryAndGenerateReport(summary) {
            let report = [];
            
            const times = [];
            for (let i = 1; i <= 3; i++) {
                const dateVal = getVal(`confirmTime${i}`);
                const clockVal = getVal(`confirmTimeClock${i}`);
                if (dateVal) {
                    try {
                        const date = new Date(dateVal);
                        const rocYear = date.getFullYear() - 1911;
                        const month = date.getMonth() + 1;
                        const day = date.getDate();
                        const formattedDate = `${rocYear}/${String(month).padStart(2, '0')}/${String(day).padStart(2, '0')}`;
                        times.push(`${formattedDate} ${clockVal}`.trim());
                    } catch (e) {
                         times.push(`${dateVal} ${clockVal}`.trim());
                    }
                } else if (clockVal) {
                    times.push(clockVal);
                }
            }
            report.push(`å£¹ã€ç¢ºèªæ™‚é–“ï¼š${times.join('ã€')}`);
            report.push(`è²³ã€è¯ç¹«é›»è©±ï¼š${getVal('contactPhone')}`);
            report.push('åƒã€ç”Ÿæ´»ç‹€æ³ï¼š');

            const isIndependent = getVal('selfCareStatus') === 'ç”Ÿæ´»è‡ªç†ç„¡è™';
            report.push(`ä¸€ã€${isIndependent ? 'â– ' : 'â–¡'}å…·ç”Ÿæ´»è‡ªç†èƒ½åŠ›`);
            
            const assistKeywords = ['ç›¥æ´—','æ›´è¡£','ç”¨é¤','å‚™é¤','å¦‚å»','ç§»ä½','å®¤å…§ç§»å‹•','å®¤å¤–ç§»å‹•','å®‰å…¨ç…§é¡§','å®¶å‹™'];
            let assistChecks = '';
            const assistAllChecked = getEl('assistAllCheckbox').checked;
            
            if (!isIndependent) {
                if (assistAllChecked) {
                    assistChecks = assistKeywords.map(k => `â–¡${k}`).join(' ');
                } else {
                    assistChecks = assistKeywords.map(k => {
                        const cb = document.querySelector(`.assist-checkbox[value="${k}"]`);
                        return `${cb && cb.checked ? 'â– ' : 'â–¡'}${k}`;
                    }).join(' ');
                }
            } else {
                assistChecks = assistKeywords.map(k => `â–¡${k}`).join(' ');
            }
            report.push(`äºŒã€${!isIndependent ? 'â– ' : 'â–¡'}éœ€ä»–äººå”åŠ© ${!isIndependent && assistAllChecked ? 'â– ' : 'â–¡'}å…¨éƒ¨(${assistChecks})`);

            const noAids = getVal('aidsStatus') === 'ç§»è¡Œç„¡é ˆè¼”å…·';
            let lifeAidsText = '', medicalAidsText = '';
            if (!noAids) {
                let aidsDetails = getVal('aidsDetailSelect');
                if(aidsDetails === 'custom') aidsDetails = getVal('aidsDetailCustom');
                lifeAidsText = aidsDetails;
            }
            report.push(`ä¸‰ã€è¼”å…·ä½¿ç”¨ç‹€æ³ï¼š${noAids ? 'â– ' : 'â–¡'}ç„¡éœ€æ±‚ ${lifeAidsText ? `â– ç”Ÿæ´»è¼”å…·_${lifeAidsText}` : 'â–¡ç”Ÿæ´»è¼”å…·__'} ${medicalAidsText ? `â– é†«ç™‚è¼”å…·_${medicalAidsText}` : 'â–¡é†«ç™‚è¼”å…·__'}`);

            const noNursingNeed = getVal('nursingStatus') === 'ç„¡';
            const nursingKeywords = ['é¼»èƒƒç®¡', 'æ°£åˆ‡', 'å°¿ç®¡', 'è¤¥ç˜¡', 'é€ å»”å£', 'æ´—è…'];
            let nursingChecks = nursingKeywords.map(k => {
                 const cb = document.querySelector(`.nursing-checkbox[value="${k}"]`);
                 return `${!noNursingNeed && cb && cb.checked ? 'â– ' : 'â–¡'}${k}`;
            }).join(' ');
            let otherNursingText = (!noNursingNeed && getEl('nursingOtherCheckbox').checked) ? getVal('nursingDetailCustom') : '';
            report.push(`å››ã€è­·ç†éœ€æ±‚ï¼š${noNursingNeed ? 'â– ' : 'â–¡'}ç„¡ ${nursingChecks} ${otherNursingText ? `â– å…¶ä»–_${otherNursingText}` : 'â–¡å…¶ä»–__'}`);
            
            report.push('äº”ã€è‡ªé–‰/æ™ºéšœ/ç²¾éšœéšœç¤™è€…â–¡æ‡·å­•ä¸­ã€â–¡è‚²æœ‰18æ­²ä»¥ä¸‹å­å¥³ï¼Œä¸”å­å¥³ç‚ºâ–¡èº«éšœè€…');
            report.push('å…­ã€â–¡ç„¡æä¾›è³‡è¨Šæ„é¡˜');
            
            const schoolKeywords = ['å¹¼å…’åœ’', 'å°å­¸ä¸€èˆ¬ç­', 'å°å­¸ç‰¹æ•™è³‡æºç­', 'åœ‹ä¸­ä¸€èˆ¬ç­', 'åœ‹ä¸­ç‰¹æ•™è³‡æºç­', 'é«˜ä¸­', 'å¤§å­¸'];
            let schoolChecks = schoolKeywords.map(k => `${summary.includes(k) ? 'â– ' : 'â–¡'}${k}`).join(' ');
            report.push(`è‚†ã€å°±å­¸ç‹€æ³ï¼š${schoolChecks}ï¼Œâ–¡ä½¿ç”¨èª²å¾Œç…§é¡§`);

            report.push('ä¼ã€å°±æ¥­ç‹€æ³ï¼š');
            const isUnemployed = summary.includes('ç„¡æ¥­');
            report.push(`ä¸€ã€${isUnemployed ? 'â– ' : 'â–¡'}æœªå°±æ¥­ã€â–¡ç„¡å·¥ä½œç¶“é©—â–¡åŠå¹´å…§æ›¾æœ‰å·¥ä½œç¶“é©—ã€‘`);
            report.push('äºŒã€â–¡æœ‰å°±æ¥­æ„é¡˜ã€â–¡æä¾›å°±æ¥­æœå‹™è³‡è¨Šâ–¡éœ€è½‰ä»‹å°±æ¥­æœå‹™ã€‘');
            report.push('ä¸‰ã€â–¡ç„¡é ˆæä¾›å°±æ¥­æœå‹™è³‡è¨ŠåŸå› ã€â–¡ç„¡å°±æ¥­æ„é¡˜â–¡ç„¡å°±æ¥­èƒ½åŠ›â–¡å¯è‡ªå·±æ‰¾å·¥ä½œâ–¡æº–å‚™è€ƒè©¦â–¡å…¶ä»–__ã€‘');
            report.push('å››ã€â–¡ç„¡æä¾›è³‡è¨Šæ„é¡˜');

            report.push('é™¸ã€é•·ç…§æœå‹™ä½¿ç”¨ç‹€æ³ï¼š');
            const ltcStatusValue = getVal('ltcStatus');
            const ltcNoNeed = ltcStatusValue !== 'å·²ä½¿ç”¨é•·ç…§æœå‹™';
            report.push(`ä¸€ã€${ltcNoNeed ? 'â– ' : 'â–¡'}ç„¡éœ€æ±‚ â–¡æœ‰éœ€æ±‚ï¼Œè‡ªè¿°å¯è‡ªè¡Œç”³è«‹ â–¡æœ‰éœ€æ±‚ï¼Œéœ€å”åŠ©è½‰ä»‹ â–¡ç”³è«‹ä¸­`);

            const ltcUsed = ltcStatusValue === 'å·²ä½¿ç”¨é•·ç…§æœå‹™';
            const ltcKeywords = ['å±…å®¶æœå‹™', 'å°ˆæ¥­æœå‹™', 'å–˜æ¯æœå‹™', 'ç‡Ÿé¤Šé¤é£²æœå‹™', 'æ—¥é–“ç…§é¡§æœå‹™', 'äº¤é€šæ¥é€', 'å±…å®¶ç„¡éšœç¤™ç’°å¢ƒæ”¹å–„', 'å®¶åº­æ‰˜é¡§'];
            let ltcChecks = ltcKeywords.map(k => {
                const checkbox = document.querySelector(`.ltc-checkbox[value="${k}"]`);
                return `${ltcUsed && checkbox && checkbox.checked ? 'â– ' : 'â–¡'}${k}`;
            }).join(' ');
            report.push(`äºŒã€${ltcUsed ? 'â– ' : 'â–¡'}å·²ä½¿ç”¨ã€${ltcChecks}ã€‘`);
            
            report.push('æŒã€æä¾›ä¹‹ç¦åˆ©è³‡è¨Šï¼š');
            const welfareContainer = getEl('welfareCheckboxContainer');
            for(let i = 1; i <= 5; i++) {
                const group = welfareContainer.querySelector(`[data-group="${i}"]`);
                if(group){
                    let line = Array.from(group.querySelectorAll('.welfare-checkbox')).map(cb => {
                        return `${cb.checked ? 'â– ' : 'â–¡'}${cb.value}`;
                    }).join('');

                    let prefix = ['', 'ä¸€ã€', 'äºŒã€é•·ç…§æœå‹™çš„', 'ä¸‰ã€', 'å››ã€', 'äº”ã€'][i];
                    
                    if (i === 5) {
                       const otherChecked = getEl('welfareOtherCheckbox').checked;
                       const otherText = getVal('welfareOtherText');
                       line += otherChecked && otherText ? `â– å…¶ä»–_${otherText}` : 'â–¡å…¶ä»–__';
                    }
                    report.push(`${prefix}${line}`);
                }
            }

            report.push('ç–ã€æœªç¬¦åˆå„ªè¨ªæŒ‡æ¨™(é«˜ç…§é¡§è² è·æŒ‡æ¨™ã€æ™ºèƒ½éšœç¤™åŠè‡ªé–‰ç—‡æœ‰åš´é‡æƒ…ç·’è¡Œç‚º)ã€é›™è€æŒ‡æ¨™');
            const hasTwoDisabled = getEl('twoDisabledCheckbox').checked;
            report.push(`æ‹¾ã€${hasTwoDisabled ? 'â– ' : 'â–¡'}å®¶ä¸­æœ‰å…©åä»¥ä¸Šèº«éšœè€…ï¼Œç¶“è©•ä¼°æš«ç„¡é¢¨éšª`);
            report.push(`æ‹¾å£¹ã€è¯ç¹«æ‘˜è¦ï¼š${summary}`);

            return report.join('\n');
        }
        
        // --- History Functions ---
        function saveToHistory(summary) {
            let history = JSON.parse(localStorage.getItem(historyKey)) || [];
            const timestamp = new Date().toLocaleString('zh-TW', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', hour12: false });
            const currentState = { timestamp, summary, data: captureFormState() };
            history.unshift(currentState);
            if (history.length > 50) history.pop();
            localStorage.setItem(historyKey, JSON.stringify(history));
            renderHistory();
        }

        function renderHistory() {
            const historyList = getEl('historyList');
            historyList.innerHTML = '';
            const history = JSON.parse(localStorage.getItem(historyKey)) || [];
            if (history.length === 0) {
                historyList.innerHTML = '<li class="text-slate-400 text-center text-sm py-4">å°šç„¡æ­·å²ç´€éŒ„</li>';
                return;
            }
            history.forEach((item, index) => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-grow mr-2 cursor-pointer restore-trigger" data-index="${index}">
                            <div class="font-semibold text-slate-700 text-sm">${item.timestamp}</div>
                            <p class="summary">${item.summary}</p>
                        </div>
                        <button class="btn-secondary restore-btn flex-shrink-0" data-index="${index}">è¼‰å…¥</button>
                    </div>`;
                historyList.appendChild(li);
            });
        }

        function captureFormState() {
            const state = {};
            document.querySelectorAll('#quickInputForm input, #quickInputForm select, #quickInputForm textarea').forEach(el => {
                if (el.id) state[el.id] = (el.type === 'checkbox' || el.type === 'radio') ? el.checked : el.value;
            });
            return state;
        }

        function restoreFormState(data) {
            clearForm();
            for (const id in data) {
                const el = getEl(id);
                if (el) {
                    if (el.type === 'checkbox' || el.type === 'radio') {
                        el.checked = data[id];
                    } else {
                        el.value = data[id];
                    }
                    el.dispatchEvent(new Event('change'));
                }
            }
        }

        getEl('historyList').addEventListener('click', (e) => {
            const target = e.target.closest('.restore-btn, .restore-trigger');
            if (target) {
                const index = target.dataset.index;
                const history = JSON.parse(localStorage.getItem(historyKey)) || [];
                if (history[index]) {
                    restoreFormState(history[index].data);
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }
        });
        
        getEl('clearHistoryBtn').addEventListener('click', () => {
             if (confirm('æ‚¨ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ­·å²ç´€éŒ„å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
                 localStorage.removeItem(historyKey);
                 renderHistory();
            }
        });
        
        renderHistory();

        // --- åŒ¯å‡º/åŒ¯å…¥/åˆ—å°/è¤‡è£½ åŠŸèƒ½ ---
        getEl('exportHistoryBtn').addEventListener('click', () => {
            const history = localStorage.getItem(historyKey);
            if (!history || history === '[]') {
                alert('æ²’æœ‰æ­·å²ç´€éŒ„å¯åŒ¯å‡ºã€‚');
                return;
            }
            const blob = new Blob([history], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const now = new Date();
            const timestamp = `${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2,'0')}${now.getDate().toString().padStart(2,'0')}`;
            a.download = `report_history_${timestamp}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        getEl('fileInput').addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const importedHistory = JSON.parse(e.target.result);
                    if (Array.isArray(importedHistory) && importedHistory.every(item => 'timestamp' in item && 'data' in item)) {
                         if (confirm('åŒ¯å…¥å°‡æœƒè¦†è“‹ç›®å‰çš„æ­·å²ç´€éŒ„ï¼Œç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿ')) {
                            localStorage.setItem(historyKey, JSON.stringify(importedHistory));
                            renderHistory();
                            alert('æ­·å²ç´€éŒ„å·²æˆåŠŸåŒ¯å…¥ï¼');
                        }
                    } else {
                        throw new Error('Invalid format');
                    }
                } catch (error) {
                    alert('åŒ¯å…¥å¤±æ•—ï¼šæª”æ¡ˆæ ¼å¼ä¸æ­£ç¢ºæˆ–å·²ææ¯€ã€‚');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        });

        getEl('printBtn').addEventListener('click', () => window.print());

        document.querySelectorAll('.copyBtn').forEach(btn => {
            btn.addEventListener('click', (event) => {
                const targetId = event.target.dataset.target;
                const contentWrapper = getEl(targetId);
                
                try {
                    contentWrapper.select();
                    contentWrapper.setSelectionRange(0, 99999); // For mobile devices

                    const successful = document.execCommand('copy');

                    if (successful) {
                        const originalText = event.target.textContent;
                        event.target.textContent = 'å·²è¤‡è£½ âœ…';
                        event.target.classList.add('bg-green-600', 'hover:bg-green-700');
                        setTimeout(() => {
                            event.target.textContent = originalText;
                            event.target.classList.remove('bg-green-600', 'hover:bg-green-700');
                        }, 2000);
                    } else {
                         throw new Error('Copy command was not successful');
                    }
                } catch (err) {
                    console.error('è¤‡è£½å¤±æ•—:', err);
                    alert('è¤‡è£½å¤±æ•—ï¼Œæ‚¨çš„ç€è¦½å™¨å¯èƒ½ä¸æ”¯æ´æ­¤åŠŸèƒ½ã€‚');
                } finally {
                     window.getSelection().removeAllRanges();
                }
            });
        });
    });
    </script>
</body>
</html>

